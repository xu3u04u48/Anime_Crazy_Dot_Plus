(()=>{"use strict";var e,t={m:{},u:e=>e+".bundle.js"};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&"SCRIPT"===s.currentScript.tagName.toUpperCase()&&(e=s.currentScript.src),!e)){var a=s.getElementsByTagName("script");if(a.length)for(var r=a.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=a[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=document.baseURI||self.location.href,function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"}(e||(e={}));const s=(()=>{let e=0;return()=>e++})(),a=(new Error("unknown message type"),new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first")),r=new Error("called FFmpeg.terminate()");var n;new Error("failed to import ffmpeg-core.js"),function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"}(n||(n={}));const o=new class{#e=null;#t={};#s={};#a=[];#r=[];loaded=!1;#n=()=>{this.#e&&(this.#e.onmessage=({data:{id:t,type:s,data:a}})=>{switch(s){case e.LOAD:this.loaded=!0,this.#t[t](a);break;case e.MOUNT:case e.UNMOUNT:case e.EXEC:case e.FFPROBE:case e.WRITE_FILE:case e.READ_FILE:case e.DELETE_FILE:case e.RENAME:case e.CREATE_DIR:case e.LIST_DIR:case e.DELETE_DIR:this.#t[t](a);break;case e.LOG:this.#a.forEach(e=>e(a));break;case e.PROGRESS:this.#r.forEach(e=>e(a));break;case e.ERROR:this.#s[t](a)}delete this.#t[t],delete this.#s[t]})};#o=({type:e,data:t},r=[],n)=>this.#e?new Promise((a,o)=>{const i=s();this.#e&&this.#e.postMessage({id:i,type:e,data:t},r),this.#t[i]=a,this.#s[i]=o,n?.addEventListener("abort",()=>{o(new DOMException(`Message # ${i} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(a);on(e,t){"log"===e?this.#a.push(t):"progress"===e&&this.#r.push(t)}off(e,t){"log"===e?this.#a=this.#a.filter(e=>e!==t):"progress"===e&&(this.#r=this.#r.filter(e=>e!==t))}load=({classWorkerURL:s,...a}={},{signal:r}={})=>(this.#e||(this.#e=s?new Worker(new URL(s,"file:///E:/Users/xu3u0/Desktop/ffmpeg_iframe_webpack/node_modules/@ffmpeg/ffmpeg/dist/esm/classes.js"),{type:"module"}):new Worker(new URL(t.p+t.u(138),t.b),{type:void 0}),this.#n()),this.#o({type:e.LOAD,data:a},void 0,r));exec=(t,s=-1,{signal:a}={})=>this.#o({type:e.EXEC,data:{args:t,timeout:s}},void 0,a);ffprobe=(t,s=-1,{signal:a}={})=>this.#o({type:e.FFPROBE,data:{args:t,timeout:s}},void 0,a);terminate=()=>{const e=Object.keys(this.#s);for(const t of e)this.#s[t](r),delete this.#s[t],delete this.#t[t];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(t,s,{signal:a}={})=>{const r=[];return s instanceof Uint8Array&&r.push(s.buffer),this.#o({type:e.WRITE_FILE,data:{path:t,data:s}},r,a)};mount=(t,s,a)=>this.#o({type:e.MOUNT,data:{fsType:t,options:s,mountPoint:a}},[]);unmount=t=>this.#o({type:e.UNMOUNT,data:{mountPoint:t}},[]);readFile=(t,s="binary",{signal:a}={})=>this.#o({type:e.READ_FILE,data:{path:t,encoding:s}},void 0,a);deleteFile=(t,{signal:s}={})=>this.#o({type:e.DELETE_FILE,data:{path:t}},void 0,s);rename=(t,s,{signal:a}={})=>this.#o({type:e.RENAME,data:{oldPath:t,newPath:s}},void 0,a);createDir=(t,{signal:s}={})=>this.#o({type:e.CREATE_DIR,data:{path:t}},void 0,s);listDir=(t,{signal:s}={})=>this.#o({type:e.LIST_DIR,data:{path:t}},void 0,s);deleteDir=(t,{signal:s}={})=>this.#o({type:e.DELETE_DIR,data:{path:t}},void 0,s)};o.on("log",({message:e})=>{console.log(e);const t=document.getElementById("status");t.textContent+="\n"+e,t.scrollTop=t.scrollHeight}),window.addEventListener("message",async e=>{if(!e.data||"convert"!==e.data.command)return;const{data:t,fileName:s}=e.data,a=document.getElementById("status");try{a.textContent+=`\n📥 收到 ${s}，寫入虛擬 FS...`,await o.writeFile(s,new Uint8Array(t));const e="output.mp3";a.textContent+="\n🔄 開始轉檔...",await o.exec(["-i",s,"-vn","-acodec","libmp3lame","-q:a","3",e]),a.textContent+="\n📤 讀取轉檔結果...";const r=await o.readFile(e),n="string"==typeof r?(new TextEncoder).encode(r):new Uint8Array(r),i=new Blob([n],{type:"audio/mpeg"}),c=URL.createObjectURL(i);a.textContent+="\n✅ 轉檔完成，可下載";const l=document.createElement("a");l.href=c,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c),window.parent.postMessage({status:"done",name:e},"*")}catch(e){console.error(e);const t=e instanceof Error?e.message:String(e);a.textContent+="\n❌ 轉檔失敗: "+t,window.parent.postMessage({status:"error",message:t},"*")}}),async function(){const e=document.getElementById("status");e.textContent="🚀 正在初始化 FFmpeg...",await o.load(),e.textContent="✅ FFmpeg 已就緒，等待轉檔任務...",window.parent.postMessage({status:"ready"},"*")}()})();