(()=>{"use strict";var e,t={m:{},u:e=>e+".bundle.js"};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&"SCRIPT"===s.currentScript.tagName.toUpperCase()&&(e=s.currentScript.src),!e)){var r=s.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=r[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=document.baseURI||self.location.href,function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"}(e||(e={}));const s=(()=>{let e=0;return()=>e++})(),r=(new Error("unknown message type"),new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first")),a=new Error("called FFmpeg.terminate()");var o;new Error("failed to import ffmpeg-core.js"),function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"}(o||(o={}));const n=new class{#e=null;#t={};#s={};#r=[];#a=[];loaded=!1;#o=()=>{this.#e&&(this.#e.onmessage=({data:{id:t,type:s,data:r}})=>{switch(s){case e.LOAD:this.loaded=!0,this.#t[t](r);break;case e.MOUNT:case e.UNMOUNT:case e.EXEC:case e.FFPROBE:case e.WRITE_FILE:case e.READ_FILE:case e.DELETE_FILE:case e.RENAME:case e.CREATE_DIR:case e.LIST_DIR:case e.DELETE_DIR:this.#t[t](r);break;case e.LOG:this.#r.forEach(e=>e(r));break;case e.PROGRESS:this.#a.forEach(e=>e(r));break;case e.ERROR:this.#s[t](r)}delete this.#t[t],delete this.#s[t]})};#n=({type:e,data:t},a=[],o)=>this.#e?new Promise((r,n)=>{const i=s();this.#e&&this.#e.postMessage({id:i,type:e,data:t},a),this.#t[i]=r,this.#s[i]=n,o?.addEventListener("abort",()=>{n(new DOMException(`Message # ${i} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(r);on(e,t){"log"===e?this.#r.push(t):"progress"===e&&this.#a.push(t)}off(e,t){"log"===e?this.#r=this.#r.filter(e=>e!==t):"progress"===e&&(this.#a=this.#a.filter(e=>e!==t))}load=({classWorkerURL:s,...r}={},{signal:a}={})=>(this.#e||(this.#e=s?new Worker(new URL(s,"file:///E:/Users/xu3u0/Desktop/ffmpeg_iframe_webpack/node_modules/@ffmpeg/ffmpeg/dist/esm/classes.js"),{type:"module"}):new Worker(new URL(t.p+t.u(138),t.b),{type:void 0}),this.#o()),this.#n({type:e.LOAD,data:r},void 0,a));exec=(t,s=-1,{signal:r}={})=>this.#n({type:e.EXEC,data:{args:t,timeout:s}},void 0,r);ffprobe=(t,s=-1,{signal:r}={})=>this.#n({type:e.FFPROBE,data:{args:t,timeout:s}},void 0,r);terminate=()=>{const e=Object.keys(this.#s);for(const t of e)this.#s[t](a),delete this.#s[t],delete this.#t[t];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(t,s,{signal:r}={})=>{const a=[];return s instanceof Uint8Array&&a.push(s.buffer),this.#n({type:e.WRITE_FILE,data:{path:t,data:s}},a,r)};mount=(t,s,r)=>this.#n({type:e.MOUNT,data:{fsType:t,options:s,mountPoint:r}},[]);unmount=t=>this.#n({type:e.UNMOUNT,data:{mountPoint:t}},[]);readFile=(t,s="binary",{signal:r}={})=>this.#n({type:e.READ_FILE,data:{path:t,encoding:s}},void 0,r);deleteFile=(t,{signal:s}={})=>this.#n({type:e.DELETE_FILE,data:{path:t}},void 0,s);rename=(t,s,{signal:r}={})=>this.#n({type:e.RENAME,data:{oldPath:t,newPath:s}},void 0,r);createDir=(t,{signal:s}={})=>this.#n({type:e.CREATE_DIR,data:{path:t}},void 0,s);listDir=(t,{signal:s}={})=>this.#n({type:e.LIST_DIR,data:{path:t}},void 0,s);deleteDir=(t,{signal:s}={})=>this.#n({type:e.DELETE_DIR,data:{path:t}},void 0,s)};let i=0;n.on("log",({message:e})=>{const t=document.getElementById("status");if(!t)throw new Error("❌ 無法找到 #status，請確認 HTML 中存在該元素。");t.textContent+="\n"+e,t.scrollTop=t.scrollHeight;const s=e.match(/time=([\d:.]+)/);if(s&&i>0){const e=s[1].split(":").map(parseFloat),t=3600*e[0]+60*e[1]+e[2];let r=Math.min(50+t/i*50,99);window.parent.postMessage({status:"progress",currentTime:r,totalDuration:100},"*")}}),window.addEventListener("message",async e=>{if(!e.data||"convert"!==e.data.command)return;const{data:t,fileName:s,outputName:r,Convert_arguments:a,totalDuration:o}=e.data,l=document.getElementById("status");if(!l)throw new Error("❌ 無法找到 #status，請確認 HTML 中存在該元素。");try{i=o||0,window.parent.postMessage({status:"progress",currentTime:50,totalDuration:100},"*"),l.textContent+=`\n📥 收到 ${s}，寫入虛擬 FS...`,await n.writeFile(s,new Uint8Array(t)),l.textContent+="\n🔄 開始轉檔...",await n.exec(a),l.textContent+="\n📤 讀取轉檔結果...";const e=await n.readFile(r),E="string"==typeof e?(new TextEncoder).encode(e):new Uint8Array(e);window.parent.postMessage({status:"progress",currentTime:100,totalDuration:100},"*"),window.parent.postMessage({status:"done",outputArray:E,name:r},"*")}catch(e){console.error(e);const t=e instanceof Error?e.message:String(e);l.textContent+="\n❌ 轉檔失敗: "+t,window.parent.postMessage({status:"error",message:t},"*")}}),async function(){const e=document.getElementById("status");if(!e)throw new Error("❌ 無法找到 #status，請確認 HTML 中存在該元素。");e.textContent="🚀 正在初始化 FFmpeg...",await n.load(),e.textContent="✅ FFmpeg 已就緒，等待轉檔任務...",window.parent.postMessage({status:"ready"},"*")}()})();